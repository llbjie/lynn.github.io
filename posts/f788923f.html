<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CSAPP Bomb Lab | llbjie的世界</title><meta name="author" content="llbjie"><meta name="copyright" content="llbjie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一个炸弹使用 gdb 调试程序1gdb bomb 在 74 行处设置一个断点123438  char *input;......73  input &#x3D; read_line();             &#x2F;* Get input                   *&#x2F;74  phase_1(input);                  &#x2F;* Run the phase">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP Bomb Lab">
<meta property="og:url" content="https://llbjie.github.io/posts/f788923f.html">
<meta property="og:site_name" content="llbjie的世界">
<meta property="og:description" content="第一个炸弹使用 gdb 调试程序1gdb bomb 在 74 行处设置一个断点123438  char *input;......73  input &#x3D; read_line();             &#x2F;* Get input                   *&#x2F;74  phase_1(input);                  &#x2F;* Run the phase">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://llbjie.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2024-12-05T05:15:48.000Z">
<meta property="article:modified_time" content="2025-02-25T08:00:58.000Z">
<meta property="article:author" content="llbjie">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://llbjie.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CSAPP Bomb Lab",
  "url": "https://llbjie.github.io/posts/f788923f.html",
  "image": "https://llbjie.github.io/img/butterfly-icon.png",
  "datePublished": "2024-12-05T05:15:48.000Z",
  "dateModified": "2025-02-25T08:00:58.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "llbjie",
      "url": "https://llbjie.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://llbjie.github.io/posts/f788923f.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CSAPP Bomb Lab',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">llbjie的世界</span></a><a class="nav-page-title" href="/"><span class="site-name">CSAPP Bomb Lab</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CSAPP Bomb Lab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-05T05:15:48.000Z" title="发表于 2024-12-05 13:15:48">2024-12-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-25T08:00:58.000Z" title="更新于 2025-02-25 16:00:58">2025-02-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CSAPP/">CSAPP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="第一个炸弹"><a href="#第一个炸弹" class="headerlink" title="第一个炸弹"></a>第一个炸弹</h2><h3 id="使用-gdb-调试程序"><a href="#使用-gdb-调试程序" class="headerlink" title="使用 gdb 调试程序"></a>使用 <code>gdb</code> 调试程序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb bomb</span><br></pre></td></tr></table></figure>
<h3 id="在-74-行处设置一个断点"><a href="#在-74-行处设置一个断点" class="headerlink" title="在 74 行处设置一个断点"></a>在 74 行处设置一个断点</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">38</span>  <span class="type">char</span> *input;</span><br><span class="line">......</span><br><span class="line"><span class="number">73</span>  input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line"><span class="number">74</span>  phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">break 74</span><br></pre></td></tr></table></figure>
<h3 id="运行该程序到断点位置"><a href="#运行该程序到断点位置" class="headerlink" title="运行该程序到断点位置"></a>运行该程序到断点位置</h3><p>执行<code>disassemble</code>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   0x0000000000400e32 &lt;+146&gt;:	call   0x40149e &lt;read_line&gt;</span><br><span class="line">=&gt; 0x0000000000400e37 &lt;+151&gt;:	mov    %rax,%rdi</span><br><span class="line">   0x0000000000400e3a &lt;+154&gt;:	call   0x400ee0 &lt;phase_1&gt;</span><br></pre></td></tr></table></figure>
<p>位置<code>400e3a</code> 执行<code>call</code>指令, 调用<code>phase_1</code>, 这个函数的参数是<code>input</code>, 也就是输入字符串的地址, 该函数调用前会将其值保存到<code>%rdi</code>寄存器, 对应位置<code>400e37</code>的指令</p>
<p>例如,输入的字符串是<code>hello</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers</span><br><span class="line">rax            0x603780            6305664</span><br><span class="line">rsi            0x603780            6305664</span><br><span class="line">(gdb) x/s  6305664</span><br><span class="line">0x603780 &lt;input_strings&gt;:	&quot;hello&quot;</span><br></pre></td></tr></table></figure>
<h3 id="进入-phase-1函数内部"><a href="#进入-phase-1函数内部" class="headerlink" title="进入 phase_1函数内部"></a>进入 <code>phase_1</code>函数内部</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(gdb) stepi</span><br><span class="line">0x0000000000400ee0 in phase_1 ()</span><br><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code for function phase_1:</span><br><span class="line">=&gt; 0x0000000000400ee0 &lt;+0&gt;:	sub    $0x8,%rsp</span><br><span class="line">   0x0000000000400ee4 &lt;+4&gt;:	mov    $0x402400,%esi</span><br><span class="line">   0x0000000000400ee9 &lt;+9&gt;:	call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000400eee &lt;+14&gt;:	test   %eax,%eax</span><br><span class="line">   0x0000000000400ef0 &lt;+16&gt;:	je     0x400ef7 &lt;phase_1+23&gt;</span><br><span class="line">   0x0000000000400ef2 &lt;+18&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400ef7 &lt;+23&gt;:	add    $0x8,%rsp</span><br><span class="line">   0x0000000000400efb &lt;+27&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<p>位置<code>400ee4</code>处的指令会将<code>0x402400</code>放入<code>%esi</code>中, 然后调用<code>strings_not_equal</code>函数<br>函数执行完毕后, 会根据<code>test %eax,%eax</code>的结果进行跳转, 如果该寄存器的值为<code>0</code>则表示字符串相等<code>phase_1</code>调用结束,<br>反之为<code>1</code>,表示字符串不等,跳转到<code>400ef2</code>调用<code>explode_bomb</code>,在屏幕上输出输出炸弹爆炸的信息</p>
<p>根据<code>phase_1</code>, 目标字符串保存在<code>0x402400</code>位置处, 输入的字符串的地址保存在<code>%rsi</code>中<br>使用<code>x/s address</code>即可输出该位置的字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402400</span><br><span class="line">0x402400:	&quot;Border relations with Canada have never been better.&quot;</span><br></pre></td></tr></table></figure>
<h3 id="拆弹"><a href="#拆弹" class="headerlink" title="拆弹"></a>拆弹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./bomb</span></span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="第二个炸弹"><a href="#第二个炸弹" class="headerlink" title="第二个炸弹"></a>第二个炸弹</h2><h3 id="在第-82-行设置断点"><a href="#在第-82-行设置断点" class="headerlink" title="在第 82 行设置断点"></a>在第 82 行设置断点</h3><p>在代码中找到调用 <code>phase_2</code> 函数的行，并设置断点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">82</span> phase_2(input);</span><br></pre></td></tr></table></figure>
<p>进入该函数后，反汇编：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400efc &lt;+0&gt;:	push   %rbp</span><br><span class="line">0x0000000000400efd &lt;+1&gt;:	push   %rbx</span><br><span class="line">0x0000000000400efe &lt;+2&gt;:	sub    $0x28,%rsp</span><br><span class="line">0x0000000000400f02 &lt;+6&gt;:	mov    %rsp,%rsi</span><br><span class="line">0x0000000000400f05 &lt;+9&gt;:	call   0x40145c &lt;read_six_numbers&gt;</span><br></pre></td></tr></table></figure>
<p>在 <code>0x400f05</code> 位置调用了 <code>read_six_numbers</code> 函数。此时 <code>%rdi</code> 的值是 <code>input</code> 的地址，而 <code>%rsi</code> 的值是栈顶指针 <code>%rsp</code> 的值，即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers</span><br><span class="line">rsi            0x7fffffffe400      140737488348160</span><br><span class="line">rdi            0x6037d0            6305744</span><br></pre></td></tr></table></figure>
<h3 id="分析-read-six-numbers-函数"><a href="#分析-read-six-numbers-函数" class="headerlink" title="分析 read_six_numbers 函数"></a>分析 <code>read_six_numbers</code> 函数</h3><p>函数 <code>read_six_numbers</code> 的反汇编代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code for function read_six_numbers:</span><br><span class="line">   0x000000000040145c &lt;+0&gt;:	sub    $0x18,%rsp</span><br><span class="line">   0x0000000000401460 &lt;+4&gt;:	mov    %rsi,%rdx</span><br><span class="line">   0x0000000000401463 &lt;+7&gt;:	lea    0x4(%rsi),%rcx</span><br><span class="line">   0x0000000000401467 &lt;+11&gt;:	lea    0x14(%rsi),%rax</span><br><span class="line">   0x000000000040146b &lt;+15&gt;:	mov    %rax,0x8(%rsp)</span><br><span class="line">   0x0000000000401470 &lt;+20&gt;:	lea    0x10(%rsi),%rax</span><br><span class="line">   0x0000000000401474 &lt;+24&gt;:	mov    %rax,(%rsp)</span><br><span class="line">   0x0000000000401478 &lt;+28&gt;:	lea    0xc(%rsi),%r9</span><br><span class="line">   0x000000000040147c &lt;+32&gt;:	lea    0x8(%rsi),%r8</span><br><span class="line">   0x0000000000401480 &lt;+36&gt;:	mov    $0x4025c3,%esi</span><br><span class="line">   0x0000000000401485 &lt;+41&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x000000000040148a &lt;+46&gt;:	call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br></pre></td></tr></table></figure>
<p>该函数调用 <code>sscanf</code> 将输入解析为 6 个整数。其原型为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sscanf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure>
<p>参数的映射如下：</p>
<ul>
<li><code>%rdi</code>：输入字符串的地址 (<code>input</code>)。</li>
<li><code>%rsi</code>：格式字符串地址 (<code>&quot;%d %d %d %d %d %d&quot;</code>，位于 <code>0x4025c3</code>)。</li>
<li><code>%rdx, %rcx, %r8, %r9</code>：前四个整数的地址。</li>
<li>栈中保存剩余两个整数的地址 (<code>%rsp+8</code> 和 <code>%rsp</code>)。</li>
</ul>
<p>输入数据最终被保存到以下地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rdx         0xe400</span><br><span class="line">rcx         0xe404</span><br><span class="line">r8          0xe408</span><br><span class="line">r9          0xe40c</span><br><span class="line">(%rsp)      0xe410</span><br><span class="line">(%rsp + 8)  0xe414</span><br></pre></td></tr></table></figure>
<p>验证解析的整数数量是否为 6：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040148f &lt;+51&gt;:	cmp    $0x5,%eax</span><br><span class="line">0x0000000000401492 &lt;+54&gt;:	jg     0x401499 &lt;read_six_numbers+61&gt;</span><br><span class="line">0x0000000000401494 &lt;+56&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x0000000000401499 &lt;+61&gt;:	add    $0x18,%rsp</span><br><span class="line">0x000000000040149d &lt;+65&gt;:	ret</span><br></pre></td></tr></table></figure>
<p>若解析的整数少于 6 个，会调用 <code>explode_bomb</code> 函数触发炸弹。注意：使用的是 <code>jg</code> 指令，因此解析的整数超过 6 个不会引发爆炸。</p>
<h3 id="验证数据是否符合要求"><a href="#验证数据是否符合要求" class="headerlink" title="验证数据是否符合要求"></a>验证数据是否符合要求</h3><p>接着，<code>phase_2</code> 函数开始验证解析的数据是否符合要求。</p>
<h4 id="验证第一个数是否为-1"><a href="#验证第一个数是否为-1" class="headerlink" title="验证第一个数是否为 1"></a>验证第一个数是否为 1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f0a &lt;+14&gt;:	cmpl   $0x1,(%rsp)</span><br><span class="line">0x0000000000400f0e &lt;+18&gt;:	je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">0x0000000000400f10 &lt;+20&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>若第一个数不等于 1，则触发炸弹。此时：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/4x 0x7fffffffe400</span><br><span class="line">0x7fffffffe400:	0x01	0x00	0x00	0x00</span><br></pre></td></tr></table></figure>
<p>第一个数为 1，符合要求。</p>
<h4 id="验证后续数据"><a href="#验证后续数据" class="headerlink" title="验证后续数据"></a>验证后续数据</h4><p>如果第一个数正确，跳转到 <code>0x400f30</code> 进入循环：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f30 &lt;+52&gt;:	lea    0x4(%rsp),%rbx</span><br><span class="line">0x0000000000400f35 &lt;+57&gt;:	lea    0x18(%rsp),%rbp</span><br><span class="line">0x0000000000400f3a &lt;+62&gt;:	jmp    0x400f17 &lt;phase_2+27&gt;</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>%rbp = %rsp + 0x18</code>：指向最后一个数的地址。</li>
<li><code>%rbx = %rsp + 0x4</code>：指向第二个数的地址。</li>
</ul>
<p>循环体代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f17 &lt;+27&gt;:	mov    -0x4(%rbx),%eax</span><br><span class="line">0x0000000000400f1a &lt;+30&gt;:	add    %eax,%eax</span><br><span class="line">0x0000000000400f1c &lt;+32&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">0x0000000000400f1e &lt;+34&gt;:	je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">0x0000000000400f20 &lt;+36&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x0000000000400f25 &lt;+41&gt;:	add    $0x4,%rbx</span><br><span class="line">0x0000000000400f29 &lt;+45&gt;:	cmp    %rbp,%rbx</span><br><span class="line">0x0000000000400f2c &lt;+48&gt;:	jne    0x400f17 &lt;phase_2+27&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>将上一个数（<code>%rbx-4</code>）的值乘 2。</li>
<li>将结果与当前数（<code>%rbx</code>）比较，若不相等则触发炸弹。</li>
<li>将 <code>%rbx</code> 加 4，指向下一个数。</li>
<li>若未到达 <code>%rbp</code>（最后一个数），继续循环。</li>
</ul>
<p>这一逻辑类似于以下 C 代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (numbers[i] != <span class="number">2</span> * numbers[i - <span class="number">1</span>]) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="正确输入"><a href="#正确输入" class="headerlink" title="正确输入"></a>正确输入</h3><p>经过分析，要求输入的 6 个整数是一个以 1 开始、每个数是前一个数的 2 倍的序列。正确输入为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 4 8 16 32</span><br></pre></td></tr></table></figure>
<h3 id="拆弹-1"><a href="#拆弹-1" class="headerlink" title="拆弹"></a>拆弹</h3><p>完整拆弹过程示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32 a b c</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br></pre></td></tr></table></figure>
<h2 id="第三个炸弹"><a href="#第三个炸弹" class="headerlink" title="第三个炸弹"></a>第三个炸弹</h2><h3 id="设置断点-反汇编函数"><a href="#设置断点-反汇编函数" class="headerlink" title="设置断点, 反汇编函数"></a>设置断点, 反汇编函数</h3><p>在 89 行处设置断点,进入<code>phase_3</code>函数, 反汇编该函数</p>
<ul>
<li>第一部分:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code for function phase_3:</span><br><span class="line">=&gt; 0x0000000000400f43 &lt;+0&gt;:	sub    $0x18,%rsp</span><br><span class="line">   0x0000000000400f47 &lt;+4&gt;:	lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000400f4c &lt;+9&gt;:	lea    0x8(%rsp),%rdx</span><br><span class="line">   0x0000000000400f51 &lt;+14&gt;:	mov    $0x4025cf,%esi</span><br><span class="line">   0x0000000000400f56 &lt;+19&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000400f5b &lt;+24&gt;:	call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000400f60 &lt;+29&gt;:	cmp    $0x1,%eax</span><br><span class="line">   0x0000000000400f63 &lt;+32&gt;:	jg     0x400f6a &lt;phase_3+39&gt;</span><br><span class="line">   0x0000000000400f65 &lt;+34&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>会从输入中读入两个<code>int</code>类型的数据, 放入 <code>%rsp + 0x8</code>和<code>%rsp + 0xc</code>这两个位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print $rsp</span><br><span class="line">$1 = (void *) 0x7fffffffe458</span><br></pre></td></tr></table></figure>
<p>也就是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x7fffffffe458</span> + <span class="number">0x8</span>)</span><br><span class="line"><span class="string">&#x27;0x7fffffffe460&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x7fffffffe458</span> + <span class="number">0xc</span>)</span><br><span class="line"><span class="string">&#x27;0x7fffffffe464&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>第二部分</li>
</ul>
<p>设第一个数为<code>x</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f6a &lt;+39&gt;:	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">0x0000000000400f6f &lt;+44&gt;:	ja     0x400fad &lt;phase_3+106&gt;</span><br></pre></td></tr></table></figure>
<p>根据上述汇编, <code>x &lt;= 7</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f71 &lt;+46&gt;:	mov    0x8(%rsp),%eax</span><br><span class="line">0x0000000000400f75 &lt;+50&gt;:	jmp    *0x402470(,%rax,8)</span><br></pre></td></tr></table></figure>
<p>取出位置<code>0x402470 + 8x</code>的值,将其作为下一条指令的地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x402470</span> + <span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;0x402470&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x402470</span> + <span class="number">8</span>)</span><br><span class="line"><span class="string">&#x27;0x402478&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x402470</span> + <span class="number">16</span>)</span><br><span class="line"><span class="string">&#x27;0x402480&#x27;</span></span><br></pre></td></tr></table></figure>
<p>查看这些地址存放的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/16x 0x402470</span><br><span class="line">0x402470:	0x00400f7c	0x00000000	0x00400fb9	0x00000000</span><br><span class="line">0x402480:	0x00400f83	0x00000000	0x00400f8a	0x00000000</span><br><span class="line">0x402490:	0x00400f91	0x00000000	0x00400f98	0x00000000</span><br><span class="line">0x4024a0:	0x00400f9f	0x00000000	0x00400fa6	0x00000000</span><br></pre></td></tr></table></figure>
<p>例如, 当<code>x == 0</code>时, 取出位置<code>0x402470</code>的值,也就是 <code>0x00400f7c</code>, 跳转到该地址, 执行以下指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f7c &lt;+57&gt;:	mov    $0xcf,%eax</span><br><span class="line">0x0000000000400f81 &lt;+62&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">...</span><br><span class="line">0x0000000000400fbe &lt;+123&gt;:	cmp    0xc(%rsp),%eax</span><br><span class="line">0x0000000000400fc2 &lt;+127&gt;:	je     0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">0x0000000000400fc4 &lt;+129&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>这种情况下就会比较第二个数和<code>0xcf</code>是否相等</p>
<p>同理, 当<code>x == 1</code>时, 会测试第二个数是否等于<code>0x137</code></p>
<h3 id="拆弹-2"><a href="#拆弹-2" class="headerlink" title="拆弹"></a>拆弹</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line">Halfway there!</span><br></pre></td></tr></table></figure>
<h2 id="第四个炸弹"><a href="#第四个炸弹" class="headerlink" title="第四个炸弹"></a>第四个炸弹</h2><h3 id="反汇编-phase-4函数"><a href="#反汇编-phase-4函数" class="headerlink" title="反汇编 phase_4函数"></a>反汇编 <code>phase_4</code>函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">0x0000000000401024 &lt;+24&gt;:	call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">0x0000000000401029 &lt;+29&gt;:	cmp    $0x2,%eax</span><br><span class="line">0x000000000040102c &lt;+32&gt;:	jne    0x401035 &lt;phase_4+41&gt;</span><br><span class="line">...</span><br><span class="line">0x000000000040102e &lt;+34&gt;:	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">0x0000000000401033 &lt;+39&gt;:	jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">0x0000000000401035 &lt;+41&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">...</span><br><span class="line">0x0000000000401048 &lt;+60&gt;:	call   0x400fce &lt;func4&gt;</span><br><span class="line">0x000000000040104d &lt;+65&gt;:	test   %eax,%eax</span><br><span class="line">0x000000000040104f &lt;+67&gt;:	jne    0x401058 &lt;phase_4+76&gt;</span><br><span class="line">...</span><br><span class="line">0x0000000000401051 &lt;+69&gt;:	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">0x0000000000401056 &lt;+74&gt;:	je     0x40105d &lt;phase_4+81&gt;</span><br><span class="line">0x0000000000401058 &lt;+76&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>从这段汇编代码, 可以得出以下信息:</p>
<ul>
<li>能够从输入中得到<code>两个整数</code></li>
<li>第一个数 x, <code>x &lt;= 14</code></li>
<li><code>func4</code> 函数的返回值 <code>%rax == 0</code></li>
<li>第二个数 y, <code>y == 0</code></li>
</ul>
<h3 id="反汇编-func4函数"><a href="#反汇编-func4函数" class="headerlink" title="反汇编 func4函数"></a>反汇编 <code>func4</code>函数</h3><p>从整体来看, <code>func4</code>函数调用了自己, 所以这是一个递归程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fe2 &lt;+20&gt;:	cmp    %edi,%ecx</span><br><span class="line">0x0000000000400fe4 &lt;+22&gt;:	jle    0x400ff2 &lt;func4+36&gt;</span><br><span class="line">...</span><br><span class="line">0x0000000000400fe9 &lt;+27&gt;:	call   0x400fce &lt;func4&gt;</span><br><span class="line">...</span><br><span class="line">0x0000000000400ffe &lt;+48&gt;:	call   0x400fce &lt;func4&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第一部分:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fce &lt;+0&gt;:	sub    $0x8,%rsp</span><br><span class="line">0x0000000000400fd2 &lt;+4&gt;:	mov    %edx,%eax</span><br><span class="line">0x0000000000400fd4 &lt;+6&gt;:	sub    %esi,%eax</span><br><span class="line">0x0000000000400fd6 &lt;+8&gt;:	mov    %eax,%ecx</span><br><span class="line">0x0000000000400fd8 &lt;+10&gt;:	shr    $0x1f,%ecx</span><br><span class="line">0x0000000000400fdb &lt;+13&gt;:	add    %ecx,%eax</span><br><span class="line">0x0000000000400fdd &lt;+15&gt;:	sar    $1,%eax</span><br><span class="line">0x0000000000400fdf &lt;+17&gt;:	lea    (%rax,%rsi,1),%ecx</span><br></pre></td></tr></table></figure>
<p>函数的参数分别保存在<code>%rdi, %rsi, %rdx, %rcx</code> 中,在这里使用<code>a, b, c, d</code>表示<br>调用函数时, 假设参数分别为<code>1, 0, 14, 0</code>,执行上诉汇编代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m = c = <span class="number">14</span></span><br><span class="line">m = m - b = <span class="number">14</span> - <span class="number">0</span> = <span class="number">14</span></span><br><span class="line">d = m = <span class="number">14</span></span><br><span class="line">d = d &gt;&gt; <span class="number">31</span> = <span class="number">14</span> &gt;&gt; <span class="number">31</span> = <span class="number">0</span></span><br><span class="line">m = m + d = <span class="number">14</span> + <span class="number">0</span> = <span class="number">14</span></span><br><span class="line">m = <span class="number">14</span> &gt;&gt; <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">d = <span class="number">7</span> + b = <span class="number">7</span> + <span class="number">0</span> = <span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>可以看出, 这段代码的功能是求区间<code>[b, c]</code>的中间值,保存在<code>d</code>中</p>
<p>第二部分:</p>
<p>知道了区间的中点后,将其和<code>x</code>进行比较, 会根据结果进入不同分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fe2 &lt;+20&gt;:	cmp    %edi,%ecx</span><br><span class="line">0x0000000000400fe4 &lt;+22&gt;:	jle    0x400ff2 &lt;func4+36&gt;</span><br></pre></td></tr></table></figure>
<p><strong>假设不满足<code>d &lt;= a</code>这个条件</strong> , 即中间值比<code>x</code>大, 跳转, 会执行下述汇编代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fe6 &lt;+24&gt;:	lea    -0x1(%rcx),%edx</span><br><span class="line">0x0000000000400fe9 &lt;+27&gt;:	call   0x400fce &lt;func4&gt;</span><br></pre></td></tr></table></figure>
<p>此时发起的调用为<code>func(1, 0, 6, 7)</code>, 从区间<code>[0, 6]</code>查找</p>
<p><strong>假设满足这个条件, 跳转</strong>, 执行下述汇编代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400ff2 &lt;+36&gt;:	mov    $0x0,%eax</span><br><span class="line">0x0000000000400ff7 &lt;+41&gt;:	cmp    %edi,%ecx</span><br><span class="line">0x0000000000400ff9 &lt;+43&gt;:	jge    0x401007 &lt;func4+57&gt;</span><br><span class="line">0x0000000000400ffb &lt;+45&gt;:	lea    0x1(%rcx),%esi</span><br><span class="line">0x0000000000400ffe &lt;+48&gt;:	call   0x400fce &lt;func4&gt;</span><br><span class="line">0x0000000000401003 &lt;+53&gt;:	lea    0x1(%rax,%rax,1),%eax</span><br></pre></td></tr></table></figure>
<p>这里也有两个分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400ff7 &lt;+41&gt;:	cmp    %edi,%ecx</span><br><span class="line">0x0000000000400ff9 &lt;+43&gt;:	jge    0x401007 &lt;func4+57&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>满足这个条件<code>d &gt;= a</code>, 结合上一个条件<code>d &lt;= a</code>,即<code>d == a</code>时,函数执行返回</p>
</li>
<li><p>如果不满足这个条件<code>d &gt;= a</code>, 此时发起的调用为<code>func(1, 8, 14, 7)</code><br>注意到, 这个分支会将使得<code>%rax = 2 * %rax + 1</code>, 结合函数执行返回时,要让<code>%rax = 0</code>, 也就是说,只要执行该分支的代码就必然不满足<code>%rax == 0</code>的条件</p>
</li>
</ul>
<h3 id="func4的python版本"><a href="#func4的python版本" class="headerlink" title="func4的python版本"></a><code>func4</code>的<code>python</code>版本</h3><p>根据上面, 函数的整体逻辑为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d &lt;= a:</span><br><span class="line">   <span class="keyword">if</span> d &gt;= a:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span> * fun(<span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">7</span>) + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span> * func(<span class="number">1</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<p>这是一个<strong>二分搜索, 搜索区间为[b, c]</strong>, 满足<code>%rax == 0</code>条件的<strong>x 不位于二分搜索树的右子树</strong></p>
<p>以下是<code>python</code>版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">x, y, m, n</span>):</span><br><span class="line">	a = m - y</span><br><span class="line">	n = a &gt;&gt; <span class="number">31</span></span><br><span class="line">	a = a + n</span><br><span class="line">	a = a &gt;&gt; <span class="number">1</span></span><br><span class="line">	n = a + y	 <span class="comment"># n middle of the [y, m]</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> n &lt;= x:</span><br><span class="line">		<span class="keyword">if</span> n &gt;= x:</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">		a = func(x, n + <span class="number">1</span>, m, n)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span> * a + <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		a = func(x, y, n - <span class="number">1</span>, n)</span><br><span class="line">		<span class="keyword">return</span> a * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试结果</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">15</span>):</span><br><span class="line">	<span class="keyword">if</span> func(i, <span class="number">0</span>, <span class="number">14</span>, <span class="number">0</span>) == <span class="number">0</span>:</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br><span class="line"><span class="comment"># 0 1 3 7</span></span><br><span class="line"><span class="comment"># [0, 14]</span></span><br><span class="line"><span class="comment"># [0, 7], [8, 14]</span></span><br><span class="line"><span class="comment"># [0, 3], [4, 7];</span></span><br><span class="line"><span class="comment"># [0, 1]</span></span><br><span class="line"><span class="comment"># [0, 0]</span></span><br></pre></td></tr></table></figure>
<h3 id="拆弹-3"><a href="#拆弹-3" class="headerlink" title="拆弹"></a>拆弹</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">1 311</span><br><span class="line">Halfway there!</span><br><span class="line">3 0</span><br><span class="line">So you got that one.  Try this one.</span><br></pre></td></tr></table></figure>
<h2 id="第五个炸弹"><a href="#第五个炸弹" class="headerlink" title="第五个炸弹"></a>第五个炸弹</h2><h3 id="先看汇编代码位置0x4010b3后的内容"><a href="#先看汇编代码位置0x4010b3后的内容" class="headerlink" title="先看汇编代码位置0x4010b3后的内容:"></a>先看汇编代码位置<code>0x4010b3</code>后的内容:</h3><ol>
<li>根据函数<code>strings_not_equal</code>知道,比较的应该是两个字符串</li>
<li>将 <code>rsp+16 (rsp+0x10)</code>处的值和<code>0x40245e</code>位置的值进行比较, 相等则结束,否则炸弹爆炸</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004010b3 &lt;+81&gt;:	mov    $0x40245e,%esi</span><br><span class="line">0x00000000004010b8 &lt;+86&gt;:	lea    0x10(%rsp),%rdi</span><br><span class="line">0x00000000004010bd &lt;+91&gt;:	call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">0x00000000004010c2 &lt;+96&gt;:	test   %eax,%eax</span><br><span class="line">0x00000000004010c4 &lt;+98&gt;:	je     0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">0x00000000004010c6 &lt;+100&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x00000000004010cb &lt;+105&gt;:	nopl   0x0(%rax,%rax,1)</span><br><span class="line">0x00000000004010d0 &lt;+110&gt;:	jmp    0x4010d9 &lt;phase_5+119&gt;</span><br></pre></td></tr></table></figure>
<p>看一下<code>0x40245e</code>保存的字符串,也就是要得到的字符串是<code>flyers</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x40245e</span><br><span class="line">0x40245e:	&quot;flyers&quot;</span><br></pre></td></tr></table></figure>
<h3 id="回到代码的开头-可知输入的长度为-6"><a href="#回到代码的开头-可知输入的长度为-6" class="headerlink" title="回到代码的开头,可知输入的长度为 6"></a>回到代码的开头,可知输入的长度为 <code>6</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040107a &lt;+24&gt;:	call   0x40131b &lt;string_length&gt;</span><br><span class="line">0x000000000040107f &lt;+29&gt;:	cmp    $0x6,%eax</span><br><span class="line">0x0000000000401082 &lt;+32&gt;:	je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">0x0000000000401084 &lt;+34&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<h3 id="代码的主体部分"><a href="#代码的主体部分" class="headerlink" title="代码的主体部分"></a>代码的主体部分</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040108b &lt;+41&gt;:	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">0x000000000040108f &lt;+45&gt;:	mov    %cl,(%rsp)</span><br><span class="line">0x0000000000401092 &lt;+48&gt;:	mov    (%rsp),%rdx</span><br><span class="line">0x0000000000401096 &lt;+52&gt;:	and    $0xf,%edx</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401067 &lt;+5&gt;:	mov    %rdi,%rbx</span><br></pre></td></tr></table></figure>
<ol>
<li><p>根据代码开头的汇编,知道<code>rbx</code>保存了输入的位置,结合这部分代码,会取出输入的最低 <code>4</code> 位放入<code>edx</code>中</p>
</li>
<li><p>然后下面接下来的指令:</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401099 &lt;+55&gt;:	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">0x00000000004010a0 &lt;+62&gt;:	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">0x00000000004010a4 &lt;+66&gt;:	add    $0x1,%rax</span><br><span class="line">0x00000000004010a8 &lt;+70&gt;:	cmp    $0x6,%rax</span><br><span class="line">0x00000000004010ac &lt;+74&gt;:	jne    0x40108b &lt;phase_5+41&gt;</span><br></pre></td></tr></table></figure>
<p><code>0x401099</code>处指令表示取出<code>0x4024b0+rdx</code>的 1 字节并零扩展到 4 字节放入<code>edx</code>中<br>然后将<code>dl</code>中的数据放入<code>0x10(%rsp,%rax,1)</code>位置处<br>最后将<code>rax</code>的值加 1, 重复上诉过程</p>
<p>查看<code>0x4024b0</code>位置处的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4024b0</span><br><span class="line">0x4024b0 &lt;array.3449&gt;:	&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span><br></pre></td></tr></table></figure>
<p>所以可以知道,代码的整体流程会从<code>0x4024b0</code>挑选出<code>6</code>个字符,放在以<code>rsp+16</code>开始的位置,不妨取偏移为<code>9 15 14 5 6 7</code>,即<code>9 f e 5 6 7</code><br>比较 <code>ASCII</code>码表,选择低字节满足要求的字符,不妨取<code>9on567</code><br>注意,答案不止一种</p>
<h2 id="第六个炸弹"><a href="#第六个炸弹" class="headerlink" title="第六个炸弹"></a>第六个炸弹</h2><h3 id="保存输入"><a href="#保存输入" class="headerlink" title="保存输入"></a>保存输入</h3><p>位置<code>0x401106</code>处的指令<code>call   0x40145c &lt;read_six_numbers&gt;</code><br>根据前面的阶段可以知道会读入<code>6</code>个数,分别放入位置 <code>rsp, rsp+4, rsp+8, rsp+12, rsp+16, rsp+20</code></p>
<h3 id="检查输入"><a href="#检查输入" class="headerlink" title="检查输入"></a>检查输入</h3><p>从<code>0x401117</code>到<code>0x401151</code>处的指令会对输入做一些检查</p>
<ol>
<li>每个数都小于等于 6,并且大于 0</li>
<li>每个数各不相同</li>
</ol>
<h4 id="检查一"><a href="#检查一" class="headerlink" title="检查一"></a>检查一</h4><p>寄存器<code>r13</code>初始值为<code>rsp</code>的值,也就是第一个输入的值<br>位置<code>0x401114</code>到<code>0x401123</code>处的指令会比较该值减去 1 和 5 的关系,如果大与 5,炸弹爆炸,否则正常进行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401114 &lt;+32&gt;:	mov    %r13,%rbp</span><br><span class="line">0x0000000000401117 &lt;+35&gt;:	mov    0x0(%r13),%eax</span><br><span class="line">0x000000000040111b &lt;+39&gt;:	sub    $0x1,%eax</span><br><span class="line">0x000000000040111e &lt;+42&gt;:	cmp    $0x5,%eax</span><br><span class="line">0x0000000000401121 &lt;+45&gt;:	jbe    0x401128 &lt;phase_6+52&gt;</span><br><span class="line">0x0000000000401123 &lt;+47&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>位置<code>0x40114d</code>处的指令, 将<code>r13</code>的值加 4,也就是下一个输入的位置,然后重新跳转到<code>0x401114</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040114d &lt;+89&gt;:	add    $0x4,%r13</span><br><span class="line">0x0000000000401151 &lt;+93&gt;:	jmp    0x401114 &lt;phase_6+32&gt;</span><br></pre></td></tr></table></figure>
<p>在每次检查,寄存器<code>r12d</code>会增加 1<br>位置<code>0x40112c</code>处的指令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040112c &lt;+56&gt;:	cmp    $0x6,%r12d</span><br><span class="line">0x0000000000401130 &lt;+60&gt;:	je     0x401153 &lt;phase_6+95&gt;</span><br></pre></td></tr></table></figure>
<p>知当寄存器<code>r12d</code>等于 6 时,结束循环,且<code>r12d</code>表示这是第几个输入</p>
<h4 id="检查二"><a href="#检查二" class="headerlink" title="检查二"></a>检查二</h4><p>检查一是外层循环, 内层循环会检查各个数之间的相等关系<br>位置<code>0x401132</code>到位置<code>0x40114b</code>是内层循环的主体部分, 寄存器<code>ebx</code>是迭代变量,通过<code>0x401138</code>处的指令<code>mov (%rsp,%rax,4),%eax</code>, 将值放入<code>eax</code>中<br>然后比较<code>eax</code>和<code>rbp</code>中的值<br>如果不等,正常进行,否则炸弹爆炸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 0x0000000000401132 &lt;+62&gt;:	mov    %r12d,%ebx</span><br><span class="line">0x0000000000401135 &lt;+65&gt;:	movslq %ebx,%rax</span><br><span class="line">0x0000000000401138 &lt;+68&gt;:	mov    (%rsp,%rax,4),%eax</span><br><span class="line">0x000000000040113b &lt;+71&gt;:	cmp    %eax,0x0(%rbp)</span><br><span class="line">0x000000000040113e &lt;+74&gt;:	jne    0x401145 &lt;phase_6+81&gt;</span><br><span class="line">0x0000000000401140 &lt;+76&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x0000000000401145 &lt;+81&gt;:	add    $0x1,%ebx</span><br><span class="line">0x0000000000401148 &lt;+84&gt;:	cmp    $0x5,%ebx</span><br><span class="line">0x000000000040114b &lt;+87&gt;:	jle    0x401135 &lt;phase_6+65&gt;</span><br></pre></td></tr></table></figure>
<p>从检查二和检查一可以知道,这六个输入为 1 到 6 的数,且各不相等</p>
<h3 id="处理输入"><a href="#处理输入" class="headerlink" title="处理输入"></a>处理输入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401153 &lt;+95&gt;:	lea    0x18(%rsp),%rsi</span><br><span class="line">0x0000000000401158 &lt;+100&gt;:	mov    %r14,%rax</span><br><span class="line">0x000000000040115b &lt;+103&gt;:	mov    $0x7,%ecx</span><br><span class="line">0x0000000000401160 &lt;+108&gt;:	mov    %ecx,%edx</span><br><span class="line">0x0000000000401162 &lt;+110&gt;:	sub    (%rax),%edx</span><br><span class="line">0x0000000000401164 &lt;+112&gt;:	mov    %edx,(%rax)</span><br><span class="line">0x0000000000401166 &lt;+114&gt;:	add    $0x4,%rax</span><br><span class="line">0x000000000040116a &lt;+118&gt;:	cmp    %rsi,%rax</span><br><span class="line">0x000000000040116d &lt;+121&gt;:	jne    0x401160 &lt;phase_6+108&gt;</span><br></pre></td></tr></table></figure>
<p>这部分代码的功能为 x = 7 - x,并将结果放回原处,x 为输入的数据</p>
<h3 id="获取节点的位置"><a href="#获取节点的位置" class="headerlink" title="获取节点的位置"></a>获取节点的位置</h3><p>指令跳转到<code>0x401197</code>处, 将值保存到寄存器<code>ecx</code>中,而且结合下面的指令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040118d &lt;+153&gt;:	add    $0x4,%rsi</span><br><span class="line">0x0000000000401191 &lt;+157&gt;:	cmp    $0x18,%rsi</span><br><span class="line">0x0000000000401195 &lt;+161&gt;:	je     0x4011ab &lt;phase_6+183&gt;</span><br></pre></td></tr></table></figure>
<p>可以知道:</p>
<ol>
<li>这是个循环, 只有当<code>rsi</code>等于<code>0x18</code>时才会推出循环</li>
<li><code>ecx</code>保存的是输入值</li>
</ol>
<p>该循环也有一个内层循环,位置从<code>0x401176</code>到<code>0x40117f</code>:<br>会根据<code>ecx</code>的值进行循环,每次循环将<code>rdx</code>的值加 8,当<code>eax = ecx</code>时,将<code>rdx</code>的值保存到<code>0x20(%rsp,%rsi,2)</code>位置处</p>
<p>根据上面的代码, 可以知道会将节点位置分别保存在<code>rsp+20, rsp+28, rsp+30, rsp+38, rsp+40, rsp+48</code>(16 进制),<br>这些节点和<code>7-x</code>存在一一对应的关系,如当<code>7-x==1</code>时,该位置则对应第一个节点,</p>
<p>最后在 <code>0x401195</code>处结束循环, 跳转到 位置<code>4011ab</code></p>
<h3 id="链接节点"><a href="#链接节点" class="headerlink" title="链接节点"></a>链接节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004011ab &lt;+183&gt;:	mov    0x20(%rsp),%rbx</span><br><span class="line">0x00000000004011b0 &lt;+188&gt;:	lea    0x28(%rsp),%rax</span><br><span class="line">0x00000000004011b5 &lt;+193&gt;:	lea    0x50(%rsp),%rsi</span><br><span class="line"></span><br><span class="line">0x00000000004011ba &lt;+198&gt;:	mov    %rbx,%rcx</span><br><span class="line">0x00000000004011bd &lt;+201&gt;:	mov    (%rax),%rdx</span><br><span class="line">0x00000000004011c0 &lt;+204&gt;:	mov    %rdx,0x8(%rcx)</span><br><span class="line">0x00000000004011c4 &lt;+208&gt;:	add    $0x8,%rax</span><br><span class="line">0x00000000004011c8 &lt;+212&gt;:	cmp    %rsi,%rax</span><br><span class="line">0x00000000004011cb &lt;+215&gt;:	je     0x4011d2 &lt;phase_6+222&gt;</span><br><span class="line">0x00000000004011cd &lt;+217&gt;:	mov    %rdx,%rcx</span><br><span class="line">0x00000000004011d0 &lt;+220&gt;:	jmp    0x4011bd &lt;phase_6+201&gt;</span><br><span class="line">0x00000000004011d2 &lt;+222&gt;:	movq   $0x0,0x8(%rdx)</span><br></pre></td></tr></table></figure>
<p><code>0x4011c0</code>处的指令会将节点链接起来,形成一个链表,链表的顺序为<code>7 - x</code>的顺序,</p>
<h3 id="比较节点大小"><a href="#比较节点大小" class="headerlink" title="比较节点大小"></a>比较节点大小</h3><p><code>0x4011e3</code>取出 4 字节的内容放入<code>eax</code>中<br>比较<code>rbx</code>地址保存的值和<code>eax</code>比较,若后者大于前者则正常进行,否则炸弹爆炸,以此类推<br>节点 1 &gt; 节点 2 &gt; 节点 3 &gt; 节点 4 &gt; 节点 5 &gt; 节点 6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004011df &lt;+235&gt;:	mov    0x8(%rbx),%rax</span><br><span class="line">0x00000000004011e3 &lt;+239&gt;:	mov    (%rax),%eax</span><br><span class="line">0x00000000004011e5 &lt;+241&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">0x00000000004011e7 &lt;+243&gt;:	jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">0x00000000004011e9 &lt;+245&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>查看 <code>0x6032d0</code>开始的节点和其值<br><img src="/images/image.png" alt="alt text"></p>
<!-- |node|值 16 进制|10 进制|

|---|---|--|
|1|0x014c|332|f
|2|0x00a8|168|
|3|0x039c|924|
|4|0x02b3|691|
|5|0x01dd|477|
|6|0x01bb|443| -->
<p>要满足递减的顺序,所以其排列为<code>3, 4, 5, 6, 1, 2</code><br>所以输入的数为<code>7-x</code>, 即<code>4, 3, 2, 1, 6, 5</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://llbjie.github.io">llbjie</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://llbjie.github.io/posts/f788923f.html">https://llbjie.github.io/posts/f788923f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://llbjie.github.io" target="_blank">llbjie的世界</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/61702333.html" title="CSAPP Data Lab"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">CSAPP Data Lab</div></div><div class="info-2"><div class="info-item-1">bitXor12345678910/* * bitXor - x^y using only ~ and &amp; *   Example: bitXor(4, 5) = 1 *   Legal ops: ~ &amp; *   Max ops: 14 *   Rating: 1 */int bitXor(int x, int y) &#123;  return ~(~y &amp; ~x) &amp; ~(x &amp; y);&#125; tmin123456789/* * tmin - return minimum two&#x27;s complement integer *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; *   Max ops: 4 *   Rating: 1 */int tmin(void) &#123;  return 1 &lt;&lt; 31;&#125; isTmax12345678910/* * isTmax - returns 1 if x is the maximum,...</div></div></div></a><a class="pagination-related" href="/posts/a4b4efe7.html" title="CSAPP Attack Lab"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CSAPP Attack Lab</div></div><div class="info-2"><div class="info-item-1">Phase 1首先获取 ctarget 的汇编代码 1objdump -d ctarget ctarget.s 查看getbuf函数,确定分配的空间 1234017a8: 48 83 ec 28           sub    $0x28,%rsp4017ac: 48 89 e7              mov    %rsp,%rdi4017af: e8 8c 02 00 00        call   401a40 &lt;Gets&gt; 发现分配了0x28 = 40字节的空间用于保存输入, 从而知道调用函数的返回地址是%rsp + 40处,只要将这个地址用touch1的地址覆盖,即可完成攻击 查看touch1的地址 100000000004017c0 &lt;touch1&gt;: 也就是在0x4017c0处所以得到我们的输入字符串为 12345600 00 00 00 00 00 00 0000 00 00 00 00 00 00 0000 00 00 00 00 00 00 0000 00 00 00 00 00 00 0000 00 00 00 00 00...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">llbjie</div><div class="author-info-description">时时勤拂拭</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/llbjie"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.</span> <span class="toc-text">第一个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-gdb-%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.1.</span> <span class="toc-text">使用 gdb 调试程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-74-%E8%A1%8C%E5%A4%84%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA%E6%96%AD%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">在 74 行处设置一个断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E8%AF%A5%E7%A8%8B%E5%BA%8F%E5%88%B0%E6%96%AD%E7%82%B9%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">运行该程序到断点位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5-phase-1%E5%87%BD%E6%95%B0%E5%86%85%E9%83%A8"><span class="toc-number">1.4.</span> <span class="toc-text">进入 phase_1函数内部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%BC%B9"><span class="toc-number">1.5.</span> <span class="toc-text">拆弹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">2.</span> <span class="toc-text">第二个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%AC%AC-82-%E8%A1%8C%E8%AE%BE%E7%BD%AE%E6%96%AD%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">在第 82 行设置断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90-read-six-numbers-%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">分析 read_six_numbers 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E8%A6%81%E6%B1%82"><span class="toc-number">2.3.</span> <span class="toc-text">验证数据是否符合要求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%95%B0%E6%98%AF%E5%90%A6%E4%B8%BA-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">验证第一个数是否为 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%90%8E%E7%BB%AD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">验证后续数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E8%BE%93%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">正确输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%BC%B9-1"><span class="toc-number">2.5.</span> <span class="toc-text">拆弹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">3.</span> <span class="toc-text">第三个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%AD%E7%82%B9-%E5%8F%8D%E6%B1%87%E7%BC%96%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">设置断点, 反汇编函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%BC%B9-2"><span class="toc-number">3.2.</span> <span class="toc-text">拆弹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">4.</span> <span class="toc-text">第四个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96-phase-4%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">反汇编 phase_4函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96-func4%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">反汇编 func4函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#func4%E7%9A%84python%E7%89%88%E6%9C%AC"><span class="toc-number">4.3.</span> <span class="toc-text">func4的python版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%BC%B9-3"><span class="toc-number">4.4.</span> <span class="toc-text">拆弹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">5.</span> <span class="toc-text">第五个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E7%9C%8B%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E4%BD%8D%E7%BD%AE0x4010b3%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">5.1.</span> <span class="toc-text">先看汇编代码位置0x4010b3后的内容:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E5%88%B0%E4%BB%A3%E7%A0%81%E7%9A%84%E5%BC%80%E5%A4%B4-%E5%8F%AF%E7%9F%A5%E8%BE%93%E5%85%A5%E7%9A%84%E9%95%BF%E5%BA%A6%E4%B8%BA-6"><span class="toc-number">5.2.</span> <span class="toc-text">回到代码的开头,可知输入的长度为 6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%9A%84%E4%B8%BB%E4%BD%93%E9%83%A8%E5%88%86"><span class="toc-number">5.3.</span> <span class="toc-text">代码的主体部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">6.</span> <span class="toc-text">第六个炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E8%BE%93%E5%85%A5"><span class="toc-number">6.1.</span> <span class="toc-text">保存输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%BE%93%E5%85%A5"><span class="toc-number">6.2.</span> <span class="toc-text">检查输入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E4%B8%80"><span class="toc-number">6.2.1.</span> <span class="toc-text">检查一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E4%BA%8C"><span class="toc-number">6.2.2.</span> <span class="toc-text">检查二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%BE%93%E5%85%A5"><span class="toc-number">6.3.</span> <span class="toc-text">处理输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%8A%82%E7%82%B9%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">6.4.</span> <span class="toc-text">获取节点的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E8%8A%82%E7%82%B9"><span class="toc-number">6.5.</span> <span class="toc-text">链接节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%8A%82%E7%82%B9%E5%A4%A7%E5%B0%8F"><span class="toc-number">6.6.</span> <span class="toc-text">比较节点大小</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/705bf0de.html" title="滑动窗口与双指针">滑动窗口与双指针</a><time datetime="2025-03-03T06:05:09.000Z" title="发表于 2025-03-03 14:05:09">2025-03-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/a4b4efe7.html" title="CSAPP Attack Lab">CSAPP Attack Lab</a><time datetime="2025-02-25T07:55:15.000Z" title="发表于 2025-02-25 15:55:15">2025-02-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/f788923f.html" title="CSAPP Bomb Lab">CSAPP Bomb Lab</a><time datetime="2024-12-05T05:15:48.000Z" title="发表于 2024-12-05 13:15:48">2024-12-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/61702333.html" title="CSAPP Data Lab">CSAPP Data Lab</a><time datetime="2024-11-19T09:55:48.000Z" title="发表于 2024-11-19 17:55:48">2024-11-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/d4db4340.html" title="网格图 DP">网格图 DP</a><time datetime="2024-11-03T05:09:23.000Z" title="发表于 2024-11-03 13:09:23">2024-11-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By llbjie</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23liMZg6j3ykyWLmCk',
      clientSecret: '2b40b0a577fead500540ce9829257abb70aa177a',
      repo: 'llbjie.github.io',
      owner: 'llbjie',
      admin: ['llbjie'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || '3bf72df23549d5bca5b46b8a151e5408'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>